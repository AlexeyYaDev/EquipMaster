<Window x:Class="EquipMaster.Views.LogEntriesWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:EquipMaster.ViewModels"
        Title="Журнал действий"
        Height="600" Width="900"
        WindowStartupLocation="CenterOwner">
    <Window.DataContext>
        <vm:LogEntriesViewModel />
    </Window.DataContext>

    <DockPanel Margin="10">
        <!-- Панель фильтров -->
        <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="0,0,0,10">
            <Label Content="Поиск:" VerticalAlignment="Center" Margin="0,0,5,0"/>
            <TextBox Width="200" Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" ToolTip="Поиск по пользователю, объекту или описанию" />
            <Label Content="Сущность:" VerticalAlignment="Center" Margin="20,0,5,0"/>
            <ComboBox Width="150" ItemsSource="{Binding EntityTypes}" SelectedItem="{Binding SelectedEntityType}"/>
            <Label Content="Операция:" VerticalAlignment="Center" Margin="20,0,5,0"/>
            <ComboBox Width="150" ItemsSource="{Binding ActionTypes}" SelectedItem="{Binding SelectedActionType}"/>
            <Label Content="С даты:" VerticalAlignment="Center" Margin="20,0,5,0"/>
            <DatePicker SelectedDate="{Binding StartDate}" Width="120"/>
            <Label Content="По:" VerticalAlignment="Center" Margin="10,0,5,0"/>
            <DatePicker SelectedDate="{Binding EndDate}" Width="120"/>
            <Button Content="Обновить" Command="{Binding RefreshCommand}" Margin="20,0,0,0"/>
        </StackPanel>

        <!-- Таблица записей лога -->
        <DataGrid ItemsSource="{Binding PagedEntriesView}" AutoGenerateColumns="False"
                  IsReadOnly="True" CanUserAddRows="False" CanUserDeleteRows="False" CanUserSortColumns="True"
                  AlternatingRowBackground="#F9F9F9">
            <DataGrid.RowStyle>
                <Style TargetType="DataGridRow">
                    <Setter Property="Background" Value="White"/>
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding DisplayAction}" Value="Создание">
                            <Setter Property="Background" Value="#e6ffe6"/>
                        </DataTrigger>
                        <DataTrigger Binding="{Binding DisplayAction}" Value="Удаление">
                            <Setter Property="Background" Value="#ffe6e6"/>
                        </DataTrigger>
                        <DataTrigger Binding="{Binding DisplayAction}" Value="Изменение">
                            <Setter Property="Background" Value="#e6e6ff"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </DataGrid.RowStyle>
            <DataGrid.Columns>
                <DataGridTextColumn Header="Время" Binding="{Binding Timestamp, StringFormat=dd.MM.yyyy HH:mm:ss}" Width="180"/>
                <DataGridTextColumn Header="Пользователь" Binding="{Binding Username}" Width="150"/>
                <DataGridTextColumn Header="Объект" Binding="{Binding DisplayEntityName}" Width="150"/>
                <DataGridTextColumn Header="Операция" Binding="{Binding DisplayAction}" Width="120"/>
                <DataGridTemplateColumn Header="Описание" Width="*">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding Details}" TextWrapping="Wrap" ToolTip="{Binding Details}"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>

        <!-- Постраничная навигация -->
        <StackPanel DockPanel.Dock="Bottom" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,10,0,0">
            <Button Content="‹ Предыдущая" Command="{Binding PrevPageCommand}" IsEnabled="{Binding CanPrevPage}" Margin="5"/>
            <TextBlock VerticalAlignment="Center" Margin="10,0">
                Страница <Run Text="{Binding CurrentPage, Mode=OneWay}"/> из <Run Text="{Binding TotalPages, Mode=OneWay}"/>
            </TextBlock>
            <Button Content="Следующая ›" Command="{Binding NextPageCommand}" IsEnabled="{Binding CanNextPage}" Margin="5"/>
        </StackPanel>
    </DockPanel>
</Window>

